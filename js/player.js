// Generated by CoffeeScript 1.7.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['home', 'enemy', 'towers/fire', 'towers/nature', 'towers/water', 'towers/wind'], function(Home, Enemy, Fire, Nature, Water, Wind) {
    var Player;
    return Player = (function() {
      function Player(blockSize, gridSize, isOpponent) {
        var inner, x, y, _i, _j, _ref, _ref1;
        this.blockSize = blockSize;
        this.gridSize = gridSize;
        this.isOpponent = isOpponent;
        this.addSoldier = __bind(this.addSoldier, this);
        this.shift = 0;
        this.lives = 10;
        if (this.isOpponent == null) {
          this.isOpponent = false;
        }
        this.homePosition = {
          x: 0,
          y: 9
        };
        this.grid = {};
        this.money = 500;
        this.soldiers = [];
        for (x = _i = 0, _ref = this.gridSize; 0 <= _ref ? _i < _ref : _i > _ref; x = 0 <= _ref ? ++_i : --_i) {
          inner = {};
          for (y = _j = 0, _ref1 = this.gridSize; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
            inner[y] = {};
          }
          this.grid[x] = inner;
        }
        if (Object.keys(this.grid).length) {
          this.grid[this.homePosition.x][this.homePosition.y] = new Home(this.homePosition.x, this.homePosition.y);
        }
      }

      Player.prototype.addTower = function(type, x, y) {
        this.type = type;
        this.x = x;
        this.y = y;
        switch (this.type) {
          case "Fire":
            return this.towerfactory(new Fire(x, y), x, y);
          case "Water":
            return this.towerfactory(new Water(x, y), x, y);
          case "Nature":
            return this.towerfactory(new Nature(x, y), x, y);
          case "Wind":
            return this.towerfactory(new Wind(x, y), x, y);
        }
      };

      Player.prototype.towerfactory = function(tower, x, y) {
        if (this.money >= tower.price) {
          this.money -= tower.price;
          return this.grid[x][y] = tower;
        }
      };

      Player.prototype.sendArmy = function(wave, time) {
        var count, diff, sent, _results;
        this.wave = wave;
        this.time = time;
        this.time *= 1000;
        count = 5 + Math.round(this.wave / 5);
        sent = 0;
        diff = this.time / count;
        _results = [];
        while (count > 0) {
          setTimeout(this.addSoldier, sent);
          sent += diff;
          _results.push(count--);
        }
        return _results;
      };

      Player.prototype.addSoldier = function() {
        return this.soldiers.push(new Enemy(this.blockSize * this.homePosition.x, this.blockSize * this.homePosition.y, this.blockSize, this.gridSize));
      };

      Player.prototype.draw = function(ctx) {
        var x, y, _i, _ref, _results;
        this.ctx = ctx;
        this.copy = this.grid;
        if (this.isOpponent) {
          this.shift = this.gridSize * this.blockSize;
        }
        _results = [];
        for (x = _i = 0, _ref = this.gridSize; 0 <= _ref ? _i < _ref : _i > _ref; x = 0 <= _ref ? ++_i : --_i) {
          _results.push((function() {
            var _j, _ref1, _results1;
            _results1 = [];
            for (y = _j = 0, _ref1 = this.gridSize; 0 <= _ref1 ? _j < _ref1 : _j > _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
              if (Object.keys(this.copy[x][y]).length) {
                _results1.push(this.copy[x][y].draw(this.ctx, this.shift + x * this.blockSize, y * this.blockSize));
              } else {
                _results1.push(void 0);
              }
            }
            return _results1;
          }).call(this));
        }
        return _results;
      };

      Player.prototype.clone = function(obj) {
        var key, newInstance;
        if ((obj == null) || typeof obj !== 'object') {
          return obj;
        }
        console.log(obj);
        newInstance = new obj.constructor(obj.x, obj.y);
        for (key in obj) {
          newInstance[key] = this.clone(obj[key]);
        }
        return newInstance;
      };

      return Player;

    })();
  });

}).call(this);

//# sourceMappingURL=player.map
